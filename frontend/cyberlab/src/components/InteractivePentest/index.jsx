import { useState, useEffect } from "react";
import { IoMdArrowBack } from "react-icons/io";
import {
  Search,
  ScanLine,
  Zap,
  FileText,
  CheckCircle,
  AlertTriangle,
  Terminal,
  Globe,
  ChevronRight,
} from "lucide-react";
import "./styles.scss";

export default function InteractivePentest() {
  const [currentPhase, setCurrentPhase] = useState(0);
  const [currentStep, setCurrentStep] = useState(0);
  const [stepCompleted, setStepCompleted] = useState(false);
  const [appOpened, setAppOpened] = useState(false);
  const [foundVulnerabilities, setFoundVulnerabilities] = useState([]);
  const [userInput, setUserInput] = useState("");
  const [terminalOutput, setTerminalOutput] = useState([]);
  const [discoveredInfo, setDiscoveredInfo] = useState({
    technologies: [],
    endpoints: [],
    headers: [],
  });
  const [showHint, setShowHint] = useState(false);
  const [targetUrl] = useState("https://vulnerable-bank.local");
  const [visibleForms, setVisibleForms] = useState([]);
  const [showBrowserView, setShowBrowserView] = useState(false);
  const [sessionId, setSessionId] = useState("");
  const [phases, setPhases] = useState([]);

  useEffect(() => {
    let sid = localStorage.getItem('pentest_session_id');
    if (!sid) {
      sid = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      localStorage.setItem('pentest_session_id', sid);
    }
    setSessionId(sid);
    
    fetchPhases();
    
    fetchProgress(sid);
  }, []);

  const handleGoBack = () => {
    window.history.back();
  };

  const fetchPhases = async () => {
    try {
      const response = await fetch('http://localhost:8000/api/pentest/phases');
      const data = await response.json();
      
      const icons = [
        <Search size={30} key="search" />,
        <ScanLine size={30} key="scan" />,
        <Zap size={30} key="zap" />,
        <FileText size={30} key="file" />
      ];
      const colors = ["#4a9eff", "#ff6b6b", "#f39c12", "#9b59b6"];
      
      if (data.success && data.phases) {
        const phasesWithUI = data.phases.map((phase, index) => ({
          ...phase,
          icon: icons[index],
          color: colors[index]
        }));
        
        setPhases(phasesWithUI);
      } else {
        console.error('Invalid data format:', data);
      }
    } catch (error) {
      console.error('Error fetching phases:', error);
    }
  };

  const fetchProgress = async (sid) => {
    try {
      const response = await fetch(`http://localhost:8000/api/pentest/progress?sessionId=${sid}`);
      const data = await response.json();
      if (data.success && data.progress) {
        setCurrentPhase(data.progress.current_phase || 0);
        setCurrentStep(data.progress.current_step || 0);
        setFoundVulnerabilities(data.vulnerabilities || []);
        setDiscoveredInfo(data.discoveries || { technologies: [], endpoints: [], headers: [] });
      }
    } catch (error) {
      console.error('Error fetching progress:', error);
    }
  };

  const simulatedApp = {
    url: "https://vulnerable-bank.local",
    name: "Vulnerable Bank",
    description: "Aplikacja bankowa do test贸w penetracyjnych",
  };

  const executeCommand = async (command) => {
    const output = [...terminalOutput];
    output.push({ type: "command", text: `$ ${command}` });
    setTerminalOutput(output);

    try {
      const response = await fetch('http://localhost:8000/api/pentest/execute', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          command,
          currentPhase,
          currentStep,
          sessionId
        })
      });

      const data = await response.json();
      
      if (data.success) {
        setTerminalOutput(prev => [...prev, ...data.output]);
        
        if (data.discoveredInfo) {
          setDiscoveredInfo(prev => ({
            technologies: [...new Set([...prev.technologies, ...(data.discoveredInfo.technologies || [])])],
            endpoints: [...new Set([...prev.endpoints, ...(data.discoveredInfo.endpoints || [])])],
            headers: [...new Set([...prev.headers, ...(data.discoveredInfo.headers || [])])],
          }));
        }
        
        if (data.vulnerabilityFound) {
          setFoundVulnerabilities(prev => {
            const exists = prev.some(v => 
              v.type === data.vulnerabilityFound.type && 
              v.location === data.vulnerabilityFound.location
            );
            return exists ? prev : [...prev, data.vulnerabilityFound];
          });
        }
        
        if (data.stepCompleted) {
          handleStepComplete();
        }
      } else {
        setTerminalOutput(prev => [...prev, { type: "error", text: data.error || "Command failed" }]);
      }
    } catch (error) {
      console.error('Error executing command:', error);
      setTerminalOutput(prev => [...prev, { 
        type: "error", 
        text: "Bd poczenia z serwerem. Upewnij si 偶e backend dziaa." 
      }]);
    }
  };

  const handleStepComplete = () => {
    setStepCompleted(true);
  };

  const handleNextStep = () => {
    const nextStep = currentStep + 1;

    if (nextStep >= phases[currentPhase].steps.length) {
      if (currentPhase < phases.length - 1) {
        setCurrentPhase(currentPhase + 1);
        setCurrentStep(0);
        setTerminalOutput([]);
        setStepCompleted(false);
        setAppOpened(false);
      }
    } else {
      setCurrentStep(nextStep);
      setStepCompleted(false);
      setAppOpened(false);
    }

    setShowHint(false);
  };

  const handleAction = (action) => {
    if (action === "open-app") {
      setShowBrowserView(true);
      setVisibleForms([
        {
          title: "Login Form",
          action: "/api/login",
          fields: [
            { name: "username", type: "text", placeholder: "Username" },
            { name: "password", type: "password", placeholder: "Password" }
          ],
          button: "Login",
          additionalElements: {
            forgotPassword: true,
            footer: "Powered by Express v4.17"
          }
        }
      ]);
      
      setTerminalOutput([
        { type: "success", text: "Aplikacja otwarta w nowej karcie" },
        { type: "info", text: "Zauwa偶one elementy:" },
        { type: "info", text: "- Formularz logowania (username, password)" },
        { type: "info", text: "- Link 'Forgot password?'" },
        {
          type: "info",
          text: "- Footer z informacj: 'Powered by Express v4.17'",
        },
        { type: "info", text: "" },
        {
          type: "success",
          text: "Co dalej? Przeanalizuj stron i kliknij przycisk poni偶ej gdy skoczysz...",
        },
      ]);

      setDiscoveredInfo((prev) => ({
        ...prev,
        technologies: [...new Set([...prev.technologies, "Express v4.17"])],
        endpoints: [...new Set([...prev.endpoints, "/login", "/forgot-password"])],
      }));

      setAppOpened(true);
    } else if (action === "view-source") {
      setTerminalOutput([
        { type: "success", text: "Kod 藕r贸dowy strony:" },
        {
          type: "code",
          text: "<!-- TODO: Remove API key before production -->",
        },
        { type: "code", text: "<input type='hidden' name='csrf' value='' />" },
        { type: "code", text: "<script src='/api/v1/config.js'></script>" },
        {
          type: "success",
          text: "Znaleziono: Komentarz o API key, brak tokenu CSRF, endpoint API",
        },
      ]);

      setDiscoveredInfo((prev) => ({
        ...prev,
        endpoints: [...new Set([...prev.endpoints, "/api/v1/config.js"])],
      }));

      handleStepComplete();
    } else if (action === "confirm-analysis") {
      handleStepComplete();
    } else if (action === "check-robots") {
      executeCommand("curl " + targetUrl + "/robots.txt");
    } else if (action === "detect-technologies") {
      executeCommand("curl -I " + targetUrl);
    } else if (action === "test-login-form") {
      setTerminalOutput([
        { type: "command", text: "$ Testowanie formularza logowania..." },
        { type: "info", text: "" },
        { type: "info", text: "Test 1: admin / admin" },
        { type: "error", text: "Login failed: Invalid credentials" },
        { type: "info", text: "" },
        { type: "info", text: "Test 2: admin / password" },
        { type: "error", text: "Login failed: Invalid credentials" },
        { type: "info", text: "" },
        { type: "info", text: "Test 3: test@test.com / test123" },
        { type: "error", text: "Login failed: User not found" },
        { type: "info", text: "" },
        { type: "success", text: "Znaleziono wyciek informacji!" },
        { type: "success", text: "Aplikacja ujawnia r贸偶ne komunikaty bd贸w:" },
        { type: "success", text: "- 'Invalid credentials' = user istnieje" },
        { type: "success", text: "- 'User not found' = user nie istnieje" },
        { type: "success", text: "Atakujcy mo偶e enumerowa poprawne loginy!" },
      ]);
      handleStepComplete();
    } else if (action === "test-sql") {
      executeCommand("' OR '1'='1");
    } else if (action === "test-xss-vuln") {
      executeCommand("<script>alert('XSS')</script>");
    } else if (action === "check-csrf-protection") {
      setVisibleForms(prev => [
        ...prev,
        {
          title: "Transfer Money",
          action: "/api/transfer",
          fields: [
            { name: "recipient", type: "text", placeholder: "Recipient Account" },
            { name: "amount", type: "number", placeholder: "Amount ($)" }
          ],
          button: "Send Money",
          showCsrfWarning: true
        }
      ]);
      
      setTerminalOutput([
        { type: "command", text: "$ Analiza formularzy w aplikacji..." },
        { type: "info", text: "" },
        { type: "info", text: "Formularz 1: Login Form (/login)" },
        { type: "code", text: '<form method="POST" action="/api/login">' },
        { type: "code", text: '  <input name="username" />' },
        { type: "code", text: '  <input name="password" type="password" />' },
        { type: "code", text: '  <button type="submit">Login</button>' },
        { type: "code", text: '</form>' },
        { type: "error", text: "Brak tokenu CSRF!" },
        { type: "info", text: "" },
        { type: "info", text: "Formularz 2: Transfer Money (/transfer)" },
        { type: "code", text: '<form method="POST" action="/api/transfer">' },
        { type: "code", text: '  <input name="recipient" />' },
        { type: "code", text: '  <input name="amount" />' },
        { type: "code", text: '  <button type="submit">Send</button>' },
        { type: "code", text: '</form>' },
        { type: "error", text: "Brak tokenu CSRF!" },
        { type: "info", text: "" },
        { type: "success", text: "Podatno: Brak ochrony CSRF!" },
        { type: "success", text: "Wszystkie formularze s podatne na ataki CSRF" },
        { type: "success", text: "Atakujcy mo偶e wykona akcje w imieniu u偶ytkownika!" },
      ]);
      handleStepComplete();
    } else if (action === "test-authorization") {
      setTerminalOutput([
        { type: "command", text: "$ Testowanie kontroli dostpu..." },
        { type: "info", text: "" },
        { type: "info", text: "Test 1: Pr贸ba dostpu do /admin bez logowania" },
        { type: "command", text: "$ curl " + targetUrl + "/admin" },
        { type: "success", text: "HTTP/1.1 200 OK" },
        { type: "success", text: "<!DOCTYPE html><h1>Admin Panel</h1>..." },
        { type: "error", text: "Dostp udzielony bez autoryzacji!" },
        { type: "info", text: "" },
        { type: "info", text: "Test 2: Pr贸ba dostpu do /api/users" },
        { type: "command", text: "$ curl " + targetUrl + "/api/users" },
        { type: "success", text: '[{"id":1,"username":"admin","email":"admin@bank.com"}...]' },
        { type: "error", text: "Lista u偶ytkownik贸w dostpna publicznie!" },
        { type: "info", text: "" },
        { type: "success", text: "Podatno: Broken Access Control!" },
        { type: "success", text: "Brak weryfikacji uprawnie na endpointach /admin i /api/users" },
        { type: "success", text: "Ka偶dy mo偶e uzyska dostp do wra偶liwych zasob贸w!" },
      ]);
      handleStepComplete();
    } else if (action === "document") {
      // Show report writing interface
      const reportText = prompt(
        "Write your vulnerability report:\n\nInclude:\n- Vulnerability title\n- Description\n- Steps to reproduce\n- Impact assessment"
      );
      
      if (reportText && reportText.length > 50) {
        setTerminalOutput([
          { type: "success", text: "Report submitted successfully!" },
          { type: "info", text: "" },
          { type: "info", text: "Your report:" },
          { type: "code", text: reportText },
          { type: "info", text: "" },
          { type: "success", text: "Documented " + foundVulnerabilities.length + " vulnerabilities" },
        ]);
        handleStepComplete();
      } else {
        setTerminalOutput([
          { type: "error", text: "Report too short! Please provide detailed documentation (minimum 50 characters)." },
        ]);
      }
    } else if (action === "rate-severity") {
      // Show severity rating interface
      setTerminalOutput([
        { type: "info", text: "Rate the severity of each vulnerability:" },
        { type: "info", text: "" },
        ...foundVulnerabilities.map((vuln, index) => ({
          type: "info",
          text: `${index + 1}. ${vuln.type} - Severity: ${vuln.severity}`
        })),
        { type: "info", text: "" },
        { type: "success", text: "All vulnerabilities have been rated!" },
        { type: "info", text: "Critical: Immediate security risk" },
        { type: "info", text: "High: Significant security impact" },
        { type: "info", text: "Medium: Moderate security concern" },
        { type: "info", text: "Low: Minor security issue" },
      ]);
      handleStepComplete();
    } else if (action === "recommend") {
      // Show recommendations interface
      const recommendations = {
        "SQL Injection": "Use prepared statements and parameterized queries. Implement input validation.",
        "Cross-Site Scripting (XSS)": "Implement Content-Security-Policy headers. Sanitize and encode user input.",
        "Cross-Site Request Forgery (CSRF)": "Implement CSRF tokens. Use SameSite cookie attribute.",
        "Broken Access Control": "Implement proper authorization checks on all endpoints."
      };
      
      setTerminalOutput([
        { type: "success", text: "Security Recommendations:" },
        { type: "info", text: "" },
        ...foundVulnerabilities.map(vuln => ([
          { type: "info", text: `Vulnerability: ${vuln.type}` },
          { type: "success", text: `Fix: ${recommendations[vuln.type] || "Implement security best practices"}` },
          { type: "info", text: "" }
        ])).flat(),
        { type: "success", text: "Report complete! All recommendations documented." },
      ]);
      handleStepComplete();
    }
  };

  const currentPhaseData = phases[currentPhase];
  const currentStepData = currentPhaseData?.steps[currentStep];
  const progress =
    currentPhaseData 
      ? (currentPhase * 100 + (currentStep / currentPhaseData.steps.length) * 100) / phases.length
      : 0;

  return (
    <div className="interactive-pentest">
      <div className="pentest-header">
        <IoMdArrowBack
          size={32}
          onClick={handleGoBack}
          style={{ cursor: "pointer", color: "#27ae60" }}
        />
        <div className="header-content">
          <h1>Interactive Pentest Challenge</h1>
          <p className="subtitle">
            {phases.length === 0 ? 'Loading...' : 'Perform a real penetration test step by step'}
          </p>
        </div>
      </div>

      {phases.length === 0 ? (
        <div style={{ textAlign: 'center', padding: '2rem', color: '#27ae60' }}>
          <Terminal size={48} />
          <p>Initializing pentest environment...</p>
        </div>
      ) : (
        <>
      <div className="phase-navigation">
        {phases.map((phase, index) => (
          <div
            key={phase.id}
            className={`phase-nav-item ${
              index === currentPhase ? "active" : ""
            } ${index < currentPhase ? "completed" : ""}`}
            style={{
              borderBottomColor:
                index === currentPhase ? phase.color : "transparent",
            }}
          >
            <div className="phase-nav-icon">
              {index < currentPhase ? <CheckCircle size={20} /> : phase.icon}
            </div>
            <span>{phase.title.split(":")[1]}</span>
          </div>
        ))}
      </div>

      <div className="pentest-progress">
        <div className="progress-bar">
          <div
            className="progress-fill"
            style={{
              width: `${progress}%`,
              backgroundColor: currentPhaseData.color,
            }}
          />
        </div>
        <div className="progress-info">
          <span>Progress: {Math.round(progress)}%</span>
          <span>
            Phase {currentPhase + 1}/{phases.length}
          </span>
        </div>
      </div>

      <div
        className="current-phase"
        style={{ borderLeftColor: currentPhaseData.color }}
      >
        <div className="phase-icon" style={{ color: currentPhaseData.color }}>
          {currentPhaseData.icon}
        </div>
        <div className="phase-details">
          <h2>{currentPhaseData.title}</h2>
          <p>{currentPhaseData.description}</p>
        </div>
      </div>

      <div className="pentest-main-content">
        <div className="instructions-panel">
          <div className="step-header">
            <span className="step-number">
              {currentStep + 1}/{currentPhaseData.steps.length}
            </span>
            <h3>{currentStepData.title}</h3>
          </div>

          <div className="step-description">
            <p>{currentStepData.description}</p>
          </div>

          <div className="task-box">
            <strong>Task:</strong>
            <p>{currentStepData.task}</p>
          </div>

          {currentStepData.action === "visit" && !appOpened && (
            <button
              className="action-button"
              onClick={() => handleAction("open-app")}
            >
              <Globe size={20} />
              Open test application
            </button>
          )}

          {currentStepData.action === "visit" &&
            appOpened &&
            !stepCompleted && (
              <button
                className="action-button secondary"
                onClick={() => handleAction("confirm-analysis")}
              >
                <CheckCircle size={20} />
                I have analyzed the application - continue
              </button>
            )}

          {currentStepData.action === "view-source" && (
            <button
              className="action-button"
              onClick={() => handleAction("view-source")}
            >
              <FileText size={20} />
              See source code
            </button>
          )}

          {currentStepData.action === "check-files" && (
            <button
              className="action-button"
              onClick={() => handleAction("check-robots")}
            >
              <FileText size={20} />
              Check robots.txt
            </button>
          )}

          {currentStepData.action === "detect-tech" && (
            <button
              className="action-button"
              onClick={() => handleAction("detect-technologies")}
            >
              <Search size={20} />
              Detect technologies (curl -I)
            </button>
          )}

          {currentStepData.action === "test-login" && (
            <button
              className="action-button"
              onClick={() => handleAction("test-login-form")}
            >
              <Terminal size={20} />
              Test various login combinations
            </button>
          )}

          {currentStepData.action === "test-sqli" && (
            <button
              className="action-button"
              onClick={() => handleAction("test-sql")}
            >
              <AlertTriangle size={20} />
              Test SQL Injection
            </button>
          )}

          {currentStepData.action === "test-xss" && (
            <button
              className="action-button"
              onClick={() => handleAction("test-xss-vuln")}
            >
              <AlertTriangle size={20} />
              Test XSS
            </button>
          )}

          {currentStepData.action === "test-csrf" && (
            <button
              className="action-button"
              onClick={() => handleAction("check-csrf-protection")}
            >
              <FileText size={20} />
              Check forms for CSRF
            </button>
          )}

          {currentStepData.action === "test-authz" && (
            <button
              className="action-button"
              onClick={() => handleAction("test-authorization")}
            >
              <AlertTriangle size={20} />
              Test access control
            </button>
          )}

          <button
            className="hint-button"
            onClick={() => setShowHint(!showHint)}
          >
             {showHint ? "Hide" : "Show"} hint
          </button>

          {showHint && (
            <div className="hints-box">
              <strong>Hints:</strong>
              <ul>
                {currentStepData.hints.map((hint, index) => (
                  <li key={index}>{hint}</li>
                ))}
              </ul>
            </div>
          )}

          {stepCompleted && (
            currentPhase === 3 && currentStep === currentPhaseData.steps.length - 1 ? (
              <button 
                className="next-step-button" 
                style={{ background: '#27ae60' }}
                onClick={() => window.location.href = '/'}
              >
                Finished - Go to Main Page
              </button>
            ) : (
              <button className="next-step-button" onClick={handleNextStep}>
                Go to next step <ChevronRight size={16} />
              </button>
            )
          )}

          {!stepCompleted && (
            <div className="completion-hint">
              <AlertTriangle size={16} />
              <span>Complete the task to proceed</span>
            </div>
          )}
        </div>

        <div className="simulation-panel">
          <div className="target-info">
            <div className="target-header">
              <Globe size={20} />
              <span>Target: {simulatedApp.name}</span>
            </div>
            <div className="target-url">{simulatedApp.url}</div>
          </div>

          {showBrowserView && (
            <div className="visible-forms-section">
              <div className="forms-header">
                <h3>Vulnerable Bank - Test Application</h3>
                <div className="browser-url">{targetUrl}</div>
              </div>
              <div className="forms-container">
                {visibleForms.map((form, index) => (
                  <div key={index} className="form-preview">
                    <div className="form-title">{form.title}</div>
                    <div className="form-action">POST {form.action}</div>
                    <form className="simulated-form" onSubmit={(e) => e.preventDefault()}>
                      {form.fields.map((field, fieldIndex) => (
                        <input
                          key={fieldIndex}
                          type={field.type}
                          name={field.name}
                          placeholder={field.placeholder}
                          disabled
                        />
                      ))}
                      <button type="submit" disabled>{form.button}</button>
                      
                      {form.additionalElements?.forgotPassword && (
                        <a href="#forgot" className="forgot-password-link">
                          Forgot password?
                        </a>
                      )}
                    </form>
                    
                    {form.additionalElements?.footer && (
                      <div className="form-footer">
                        {form.additionalElements.footer}
                      </div>
                    )}
                    
                    {form.showCsrfWarning && (
                      <div className="csrf-warning">
                        No CSRF token detected! This form is vulnerable to CSRF attacks.
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>
          )}

          {currentPhase === 3 ? (
            <div className="report-editor-container">
              <div className="report-header">
                <FileText size={16} />
                <span>Penetration Test Report</span>
              </div>

              <div className="report-guidelines">
                <h4>Report Guidelines:</h4>
                <ul>
                  <li><strong>Executive Summary:</strong> Brief overview of findings</li>
                  <li><strong>Vulnerability Details:</strong> For each vulnerability include:
                    <ul>
                      <li>Title and Description</li>
                      <li>Severity Rating (Critical/High/Medium/Low)</li>
                      <li>Steps to Reproduce</li>
                      <li>Impact Assessment</li>
                      <li>Remediation Recommendations</li>
                    </ul>
                  </li>
                  <li><strong>Conclusion:</strong> Summary and overall risk assessment</li>
                </ul>
              </div>

              <div className="report-textarea-wrapper">
                <label htmlFor="report-text">Write your report below:</label>
                <textarea
                  id="report-text"
                  value={userInput}
                  onChange={(e) => setUserInput(e.target.value)}
                  placeholder="# Penetration Test Report&#10;&#10;## Executive Summary&#10;During the assessment of Vulnerable Bank application, several critical vulnerabilities were identified...&#10;&#10;## Findings&#10;&#10;### 1. SQL Injection - Critical&#10;**Description:** The login form is vulnerable to SQL injection attacks...&#10;**Steps to Reproduce:**&#10;1. Navigate to login page&#10;2. Enter: admin' OR '1'='1'--&#10;3. Observe successful bypass&#10;&#10;**Impact:** Complete database access, authentication bypass&#10;&#10;**Recommendation:** Use prepared statements and parameterized queries..."
                  rows={20}
                  style={{
                    width: '100%',
                    padding: '1rem',
                    fontSize: '0.95rem',
                    fontFamily: 'monospace',
                    backgroundColor: '#1e1e1e',
                    color: '#27ae60',
                    border: '1px solid #333',
                    borderRadius: '4px',
                    resize: 'vertical'
                  }}
                />
              </div>

              <div className="report-actions">
                <button 
                  className="action-button"
                  onClick={() => {
                    if (userInput.length > 100) {
                      handleStepComplete();
                    } else {
                      alert("Report too short! Please provide detailed documentation (minimum 100 characters).");
                    }
                  }}
                >
                  <CheckCircle size={20} />
                  Submit Report
                </button>
                
                <button 
                  className="action-button secondary"
                  onClick={() => setUserInput('')}
                  style={{ marginLeft: '1rem' }}
                >
                  Clear
                </button>
              </div>

              {terminalOutput.length > 0 && (
                <div className="report-status" style={{ marginTop: '1rem', padding: '1rem', backgroundColor: '#1e1e1e', borderRadius: '4px' }}>
                  {terminalOutput.map((line, index) => (
                    <div key={index} className={`terminal-line ${line.type}`}>
                      {line.text}
                    </div>
                  ))}
                </div>
              )}
            </div>
          ) : (
          <div className="terminal-container">
            <div className="terminal-header">
              <Terminal size={16} />
              <span>Pentester's terminal</span>
            </div>

            <div className="terminal-output">
              {terminalOutput.length === 0 ? (
                <div className="terminal-welcome">
                  <p>Welcome to the interactive pentesting terminal!</p>
                  <p>Type commands below or use the action buttons.</p>
                  <p className="terminal-hint">
                    Examples: curl, nmap, sqlmap, nikto
                  </p>
                </div>
              ) : (
                terminalOutput.map((line, index) => (
                  <div key={index} className={`terminal-line ${line.type}`}>
                    {line.text}
                  </div>
                ))
              )}
            </div>

            <div className="terminal-input">
              <span className="prompt">$</span>
              <input
                type="text"
                value={userInput}
                onChange={(e) => setUserInput(e.target.value)}
                onKeyPress={(e) => {
                  if (e.key === "Enter" && userInput.trim()) {
                    executeCommand(userInput);
                  }
                }}
                placeholder="Wpisz komend..."
              />
            </div>

            <div className="quick-commands">
              <span>Quick Commands:</span>
              <button
                onClick={() =>
                  executeCommand("curl " + targetUrl + "/robots.txt")
                }
              >
                robots.txt
              </button>
              <button onClick={() => executeCommand("curl -I " + targetUrl)}>
                Headers
              </button>
              <button onClick={() => executeCommand("' OR '1'='1")}>
                SQL Test
              </button>
              <button
                onClick={() => executeCommand("<script>alert('XSS')</script>")}
              >
                XSS Test
              </button>
            </div>
          </div>
          )}

          {(discoveredInfo.technologies.length > 0 ||
            discoveredInfo.endpoints.length > 0 ||
            foundVulnerabilities.length > 0) && (
            <div className="discovered-info">
              <h4>Discovered Information:</h4>

              {discoveredInfo.technologies.length > 0 && (
                <div className="info-section">
                  <strong>Technologies:</strong>
                  <div className="tags">
                    {discoveredInfo.technologies.map((tech, i) => (
                      <span key={i} className="tag tech-tag">
                        {tech}
                      </span>
                    ))}
                  </div>
                </div>
              )}

              {discoveredInfo.endpoints.length > 0 && (
                <div className="info-section">
                  <strong>Endpoints:</strong>
                  <div className="tags">
                    {discoveredInfo.endpoints.map((endpoint, i) => (
                      <span key={i} className="tag endpoint-tag">
                        {endpoint}
                      </span>
                    ))}
                  </div>
                </div>
              )}

              {foundVulnerabilities.length > 0 && (
                <div className="info-section vulnerabilities">
                  <strong>Found Vulnerabilities:</strong>
                  {foundVulnerabilities.map((vuln, i) => (
                    <div
                      key={i}
                      className={`vulnerability ${vuln.severity.toLowerCase()}`}
                    >
                      <div className="vuln-header">
                        <AlertTriangle size={16} />
                        <span>{vuln.type}</span>
                      </div>
                      <div className="vuln-details">
                        <span className="severity">{vuln.severity}</span>
                        <span className="location">{vuln.location}</span>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}
        </div>
      </div>
      </>
      )}
    </div>
  );
}
