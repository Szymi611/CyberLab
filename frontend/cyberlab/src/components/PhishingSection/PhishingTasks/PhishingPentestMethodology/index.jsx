import { useState } from "react";
import { CheckCircle, Circle, Lock, ArrowRight } from "lucide-react";
import "./styles.scss";
import ReconnaissancePhishing from "../ReconnaissancePhishing";
import AnalysisPhishing from "../AnalysisPhishing";
import PreventionPhishing from "../PreventionPhishing";

export default function PhishingPentestMethodology() {
  const [completedPhases, setCompletedPhases] = useState([]);
  const [currentPhase, setCurrentPhase] = useState(0);

  const phases = [
    {
      id: "reconnaissance",
      name: "Recognition",
      description: "Learn to identify phishing attempts",
      component: ReconnaissancePhishing,
    },
    {
      id: "analysis",
      name: "Analysis",
      description: "Analyze phishing attack vectors",
      component: AnalysisPhishing,
    },
    {
      id: "prevention",
      name: "Prevention",
      description: "Implement prevention strategies",
      component: PreventionPhishing,
    },
  ];

  const handlePhaseComplete = (phaseId) => {
    if (!completedPhases.includes(phaseId)) {
      setCompletedPhases([...completedPhases, phaseId]);

      const currentIndex = phases.findIndex((p) => p.id === phaseId);
      if (currentIndex < phases.length - 1) {
        setCurrentPhase(currentIndex + 1);
      }
    }
  };

  const allCompleted = completedPhases.length === phases.length;
  const CurrentPhaseComponent = phases[currentPhase]?.component;

  return (
    <div className="pentest-methodology">
      <div className="methodology-header">
        <h1>Phishing Attack Methodology</h1>
        <p>
          Learn to recognize, analyze, and prevent phishing attacks through a
          structured approach
        </p>
      </div>

      <div className="phases-tracker">
        {phases.map((phase, idx) => (
          <div
            key={phase.id}
            className={`phase-card ${currentPhase === idx ? "active" : ""} ${
              completedPhases.includes(phase.id) ? "completed" : ""
            } ${
              idx > currentPhase && !completedPhases.includes(phase.id)
                ? "locked"
                : ""
            }`}
            onClick={() => {
              if (idx <= currentPhase || completedPhases.includes(phase.id)) {
                setCurrentPhase(idx);
              }
            }}
          >
            <div className="phase-icon">
              {completedPhases.includes(phase.id) ? (
                <CheckCircle size={28} />
              ) : idx > currentPhase ? (
                <Lock size={28} />
              ) : (
                <Circle size={28} />
              )}
            </div>
            <div className="phase-info">
              <div className="phase-number">Phase {idx + 1}</div>
              <div className="phase-name">{phase.name}</div>
              <div className="phase-desc">{phase.description}</div>
            </div>
          </div>
        ))}
      </div>

      <div className="methodology-content">
        {!allCompleted && CurrentPhaseComponent && (
          <CurrentPhaseComponent
            onComplete={() => handlePhaseComplete(phases[currentPhase].id)}
          />
        )}

        {allCompleted && (
          <div className="completion-panel">
            <div className="completion-icon">ðŸŽ£</div>
            <h2>Methodology Complete!</h2>
            <p>
              You've completed all three phases of phishing attack methodology.
              You now understand how to recognize, analyze, and prevent phishing
              attacks!
            </p>
            <div className="completion-actions">
              <a href="/phishing/tasks" className="action-button primary">
                Try Practical Challenges
              </a>
              <a href="/phishing/quiz" className="action-button secondary">
                Test Your Knowledge
              </a>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
